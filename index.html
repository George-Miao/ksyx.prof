<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="robots" content="noindex" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Prof. KSYX</title>
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/asset/apple-touch-icon.png"
    />
    <link rel="icon" href="/asset/favicon.ico" type="image/x-icon" />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/asset/favicon-16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/asset/favicon-32x32.png"
    />
    <link rel="manifest" href="/asset/site.webmanifest" />
  </head>
  <body
    style="
      margin: 0;
      padding: 2em;
      box-sizing: border-box;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: clamp(0.6em, 3.2vw, 1.1em);
      font-family: apple-system, BlinkMacSystemFont, helvetica neue, Helvetica,
        Tahoma, Arial, STHeiti, pingfang sc, wenquanyi micro hei,
        microsoft yahei, sans-serif;
    "
  >
    <main
      style="
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100%;
      "
    >
      <img
        src="./logo.svg"
        alt="ksyx logo"
        style="width: 12em; height: 12em; margin-bottom: 2em"
      />
      <p>
        ksyx
        不仅是专家，还具有无比的谦逊品德，在专业上和人生上都是我最崇敬的老师。
      </p>
      <p>
        ksyx
        は専門家であるだけでなく、非常に謙虚な性格の持ち主で、仕事においても人生においても、私の最も尊敬する師匠です。
      </p>
      <p>ksyx 曾说：</p>
      <h1 style="text-align: center" id="quote"></h1>
      <div style="flex-grow: 1"></div>
    </main>
    <footer style="display: flex; flex-direction: column; align-items: center">
      <p>「我已经卖了 <span id="counter">0</span> 句菜，我 zc」</p>
      <p>
        欢迎使用
        <a href="https://t.me/realksyx_bot">@realksyx_bot</a>
      </p>
      <p>
        By
        <a href="https://t.me/popdailydose">Pop</a>, source on
        <a href="https://github.com/George-Miao/ksyx.prof">Github</a>. Credit to
        <a href="https://github.com/Trumeet">Yuuta</a> for quote API.
      </p>
    </footer>
  </body>
  <style>
    main > p {
      opacity: 60%;
      text-align: center;
      margin: 0.3em;
    }

    footer > p {
      opacity: 50%;
      margin-bottom: 0;
      font-size: 0.9rem;
    }

    a {
      color: unset;
    }
  </style>
  <script>
    const el = document.querySelector('#quote')
    const counter = document.getElementById('counter')
    const StorageKey = 'Wow, a professor from MIT!'

    let count = Math.floor(Number(localStorage.getItem(StorageKey))) || 0;

    const debounce = (fn, timeout) => {
      let timer;

      return (...args) => {
        if (timer) {
          clearTimeout(timer)
        }

        timer = setTimeout(() => {
          fn(...args)
        }, timeout)
      }
    }

    const debouncedSet = debounce((count) => {
      localStorage.setItem(StorageKey, count)
    }, 1000)

    const loadVegetable = () =>
      fetch('https://ftp.yuuta.moe/ksyxquote/')
        .then(x => x.json())
        // .then(() => {
        //   return {
        //     msg: '我真的破防了。为什么你们一个个都是学霸，音游又玩的那么好。每天看见你们在群里、动态等各种社交平台分享自己的考试成绩、音游截图、生活日常，我都羡慕至极！只有我是一个成绩又不好，音游又菜，人长得又难看，什么都不会的废物。有害垃圾！想说点什么融入你们，却也什么也拿不出来，甚至发这条说说，我都词穷，凑不出什么像话的言语来。每天看着你们聊天分享自己的生活经历，都感觉难受的要死，破防了，我真的要破防了！'
        //   }
        // })
        .then(({ msg }) => {
          if (msg.length > 12) {
            el.style.margin = '1em 0'
            el.style.fontSize = 'clamp(0.6em, 5vw, 1.8em)'
          }
          el.innerText = `「${msg}」`
        }).then(() => {
          count += 1
          counter.innerText = count
          debouncedSet(count)
        })

    window.onload = loadVegetable;

    el.addEventListener('click', loadVegetable)
  </script>
</html>
